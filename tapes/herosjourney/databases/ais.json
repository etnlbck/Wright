{
	"FightAction":{
		"cycle":{"_":["variable","cycle"]},
		"iaCallAction":"codeTurnDoFight",
        "selectedEntity":{"_":["variable","party",{"_":["variable","cycle"]}]}
	},
	"AttackMagicAction":{
		"cycle":{"_":["variable","cycle"]},
		"iaCallAction":"codeTurnDoMagic",
		"outSpell":{"_":["variable","outSpell"]},
        "selectedEntity":{"_":["variable","party",{"_":["variable","cycle"]}]}
	},
	"DefenseMagicAction":{
		"cycle":{"_":["variable","cycle"]},
		"iaCallAction":"codeTurnDoMagic",
		"outSpell":{"_":["variable","outSpell"]},
        "selectedEntity":{"_":["variable","foes",{"_":["variable","cycle"]}]}
	},
	"AttackItemAction":{
		"cycle":{"_":["variable","cycle"]},
		"iaCallAction":"codeTurnDoItem",
		"outItem":{"_":["variable","outItem"]},
		"outInventory":{"_":["variable","currentTurnEntity","inventory"]},
        "selectedEntity":{"_":["variable","party",{"_":["variable","cycle"]}]}
	},
	"DefenseItemAction":{
		"cycle":{"_":["variable","cycle"]},
		"iaCallAction":"codeTurnDoItem",
		"outItem":{"_":["variable","outItem"]},
		"outInventory":{"_":["variable","currentTurnEntity","inventory"]},
        "selectedEntity":{"_":["variable","foes",{"_":["variable","cycle"]}]}
	},
	"PassAction":{"iaCallAction":"codeTurnDoPass"},
	"RunAction":{"iaCallAction":"codeTurnDoRun"},
	"Random":[
		{"set":{"iaOptions":{"_":["new",[]]}},"as":{"_":"variable"}},
		{
			"when":{"_":["variable","currentTurnEntity","equipment"]},
			"execute":[
				{"set":{"cycle":0},"as":{"_":"variable"}},
				{
					"execute":[
						{
							"when":{"_":["variable","party",{"_":["variable","cycle"]},"hp","and",{"_":["variable","party",{"_":["variable","cycle"]},"curEscaped","not"]}]},
							"as":{"_":["resource","ais","FightAction","merged"]},
							"pushInto":{"_":["variable","iaOptions"]}
						},
						{"sum":1,"to":{"_":["variable","cycle"]}}						
					],
					"times":3
				}				
			]
		},
		{
			"when":{"_":["variable","currentTurnEntity","spells","count"]},
			"execute":[
				{"set":{"spellCycle":0,"cycle":0},"as":{"_":"variable"}},
				{
					"execute":[
						{
							"set":{"outSpell":{"_":["variable","currentTurnEntity","spells",{"_":["variable","spellCycle"]}]}},
							"as":{"_":"variable"}
						},
						{
							"when":{"_":["variable","outSpell","spellType","isEqualTo","attack"]},
							"execute":[
								{"set":{"cycle":0},"as":{"_":"variable"}},
								{
									"execute":[
										{
											"when":{"_":["variable","party",{"_":["variable","cycle"]},"hp","and",{"_":["variable","party",{"_":["variable","cycle"]},"curEscaped","not"]}]},
											"as":{"_":["resource","ais","AttackMagicAction","merged"]},
											"pushInto":{"_":["variable","iaOptions"]}
										},
										{"sum":1,"to":{"_":["variable","cycle"]}}						
									],
									"times":3
								}	
							],
							"elseExecute":[
								{"set":{"cycle":0},"as":{"_":"variable"}},
								{
									"execute":[
										{
											"when":{"_":["variable","foes",{"_":["variable","cycle"]},"hp","and",{"_":["variable","foes",{"_":["variable","cycle"]},"curEscaped","not"]}]},
											"as":{"_":["resource","ais","DefenseMagicAction","merged"]},
											"pushInto":{"_":["variable","iaOptions"]}
										},
										{"sum":1,"to":{"_":["variable","cycle"]}}						
									],
									"times":{"_":["variable","foes","count"]}
								}	
							]
						},
						{"sum":1,"to":{"_":["variable","spellCycle"]}}						
					],
					"times":{"_":["variable","currentTurnEntity","spells","count"]}
				}				
			]
		},
		{
			"when":{"_":["variable","currentTurnEntity","inventory","count"]},
			"execute":[
				{"set":{"itemCycle":0,"cycle":0},"as":{"_":"variable"}},
				{
					"execute":[
						{
							"set":{"outItem":{"_":["variable","currentTurnEntity","inventory",{"_":["variable","itemCycle"]}]}},
							"as":{"_":"variable"}
						},
						{
							"when":{"_":["variable","outItem","itemType","isEqualTo","attack"]},
							"execute":[
								{"set":{"cycle":0},"as":{"_":"variable"}},
								{
									"execute":[
										{
											"when":{"_":["variable","party",{"_":["variable","cycle"]},"hp","and",{"_":["variable","party",{"_":["variable","cycle"]},"curEscaped","not"]}]},
											"as":{"_":["resource","ais","AttackItemAction","merged"]},
											"pushInto":{"_":["variable","iaOptions"]}
										},
										{"sum":1,"to":{"_":["variable","cycle"]}}						
									],
									"times":3
								}	
							],
							"elseExecute":[
								{"set":{"cycle":0},"as":{"_":"variable"}},
								{
									"execute":[
										{
											"when":{"_":["variable","foes",{"_":["variable","cycle"]},"hp","and",{"_":["variable","foes",{"_":["variable","cycle"]},"curEscaped","not"]}]},
											"as":{"_":["resource","ais","DefenseItemAction","merged"]},
											"pushInto":{"_":["variable","iaOptions"]}
										},
										{"sum":1,"to":{"_":["variable","cycle"]}}						
									],
									"times":{"_":["variable","foes","count"]}
								}	
							]
						},
						{"sum":1,"to":{"_":["variable","itemCycle"]}}						
					],
					"times":{"_":["variable","currentTurnEntity","inventory","count"]}
				}				
			]
		},
		{
			"when":{"_":["variable","iaOptions","count","isEqualTo",0]},
			"execute":[
				{
					"as":{"_":["resource","ais","PassAction","merged"]},
					"pushInto":{"_":["variable","iaOptions"]}
				},
				{
					"as":{"_":["resource","ais","RunAction","merged"]},
					"pushInto":{"_":["variable","iaOptions"]}
				}
			]
		},
		{
			"execute":[
				{"set":{"_":"that"},"as":{"_":"variable"}},
				{"_":["stencil",{"_":["this","iaCallAction"]}]}
			],
			"as":{"_":["randomValue",{"_":["variable","iaOptions"]}]}
		}
	]
}